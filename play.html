<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Playground</title>
  </head>
  <body>
    <div id="root"></div>
    <!-- Глобальные React и ReactDOM для JSX без импортов -->
    <script type="module">
      import * as ReactModule from 'react';
      import * as ReactDOMClientModule from 'react-dom/client';
      window.React = ReactModule;
      window.ReactDOM = ReactDOMClientModule;
    </script>
    <script type="module">
      const params = new URLSearchParams(window.location.search);
      const file = params.get('file');

      if (!file) {
        document.getElementById('root').innerHTML = '<p>Добавьте параметр ?file=путь/к/файлу</p>';
      } else {
        // Декодируем кириллические символы в пути файла
        const decodedFile = decodeURIComponent(file);
        
        if (decodedFile.endsWith('.html')) {
          const iframe = document.createElement('iframe');
          iframe.style.width = '100%';
          iframe.style.height = '100vh';
          iframe.style.border = '0';
          iframe.src = decodedFile;
          document.body.appendChild(iframe);
        } else if (decodedFile.endsWith('.jsx') || decodedFile.endsWith('.tsx') || decodedFile.endsWith('.js') || decodedFile.endsWith('.ts')) {
          import(decodedFile)
            .then((mod) => {
              const mount = mod.default || mod.App || mod.Component;
              if (typeof mount === 'function') {
                import('react').then(({ createElement }) =>
                  import('react-dom/client').then(({ createRoot }) => {
                    const root = createRoot(document.getElementById('root'));
                    root.render(createElement(mount));
                  })
                );
              } else if (typeof mod.run === 'function') {
                mod.run(document.getElementById('root'));
              } else {
                document.getElementById('root').innerHTML = '<p>Модуль не экспортирует React-компонент или функцию run</p>';
              }
            })
            .catch((e) => {
              console.error(e);
              document.getElementById('root').innerHTML = '<pre style="white-space: pre-wrap;">'+String(e)+'</pre>';
            });
        } else {
          document.getElementById('root').innerHTML = '<p>Неподдерживаемый тип файла: '+decodedFile+'</p>';
        }
      }
    </script>
  </body>
  </html>


